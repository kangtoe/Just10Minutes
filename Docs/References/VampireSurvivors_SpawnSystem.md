# Vampire Survivors - Spawn System Analysis

> **핵심 요약**
>
> Vampire Survivors는 **웨이브 + 시간 기반 하이브리드** 스폰 시스템을 사용합니다.
> - 1분마다 자동으로 진행되는 웨이브
> - 최소 적 수량 유지 로직으로 일정한 압박 제공
> - 특정 시간에 트리거되는 맵 이벤트로 긴장감 조성
> - 15~30분 타임 리밋 후 The Reaper 등장으로 게임 종료

## 핵심 메커니즘

### 1. 웨이브 시스템 (Wave System)

#### 기본 구조
- **웨이브 주기**: 1분마다 새로운 웨이브 도착
- **웨이브 구성 요소**:
  - 최소 적 수량 (Minimum Amount): 화면에 유지되어야 할 최소 적 개체 수
  - 스폰 간격 (Spawn Interval): 적을 생성하는 주기

#### 스폰 로직

**분기 조건**:
- 현재 적 수 < 최소 수량 → 할당량이 채워질 때까지 계속 스폰
- 현재 적 수 ≥ 최소 수량 → 웨이브의 각 적 타입마다 1개씩만 스폰

**핵심 특징**:
- 게임이 주기적으로 스폰을 **시도** (attempt)하는 방식
- 최소 수량이 충족되지 않으면 강제로 스폰하여 할당량 채움
- 최소 수량이 충족되면 각 타입당 하나씩만 추가 스폰

### 2. 적 생성 및 제거 규칙

#### 스폰 위치
- 적들은 **화면 밖(off-screen)**에서 생성
- 플레이어가 보는 화면의 바깥 경계에서 등장

#### 디스폰 (Despawn)
- 플레이어가 적으로부터 **충분히 멀리 이동**하면 디스폰
- 메모리 및 성능 최적화를 위한 메커니즘
- 화면에서 벗어난 적은 자동으로 제거될 수 있음

### 3. 맵 이벤트 (Map Events)

#### 특징
- 정규 스폰 사이클과 **별개**로 동작하는 특수 스폰 이벤트
- 특정 웨이브에 연결되어 **고정된 시간**에 트리거
- 매 플레이마다 같은 시간에 발생 → **예측 가능**

#### 활용
- 엘리트 적 그룹 스폰
- 특수 보스 등장
- 대량의 적 웨이브
- 예시: 24-25분, 26-29분 특정 시간대에 강력한 적 출현

### 4. 시간 기반 요소

#### 스테이지 타임 리밋
- 각 스테이지는 소프트 타임 리밋 설정:
  - **15분** (짧은 스테이지)
  - **20분** (중간 길이 스테이지)
  - **30분** (긴 스테이지)

#### 타임 리밋 도달 시
1. 모든 적 제거 (화면 클리어)
2. 최종 보스 **The Reaper** 스폰
   - 압도적으로 강력한 적
   - 사실상 게임 종료를 강제하는 메커니즘

#### 시간 동기화
- 모든 시간 기반 이벤트는 **게임 내 타이머**를 기준으로 동작
- 적 스폰, 진화 상자 드롭, 웨이브 이벤트 모두 정확한 시간에 발생
- **허리 모드(Hurry Mode)**에서도 동일:
  - 시계 속도가 2배로 빨라지지만
  - 이벤트는 여전히 원래 타임스탬프에 발생

## 하이브리드 구조의 장점

| 요소 | 효과 |
|------|------|
| **일정한 난이도 곡선** | 1분마다 웨이브로 점진적 난이도 상승 |
| **예측성 + 긴장감** | 정규 웨이브는 예측 가능, 맵 이벤트로 서프라이즈 |
| **플레이어 성장 조화** | 초반(약한 적) → 중반(다양화) → 후반(압박) |
| **성능 최적화** | 화면 밖 디스폰 + 수량 관리 |

## 구현 시 고려사항

### 데이터 구조

**웨이브 데이터**:
- 발동 시간 (분)
- 적 타입 목록
- 최소 수량
- 스폰 간격

**맵 이벤트 데이터**:
- 트리거 시간 (초)
- 연결된 웨이브
- 적 그룹 구성
- 스폰 패턴

### 스폰 매니저 동작 방식

**주기적 업데이트**:
1. 경과 시간이 1분에 도달하면 다음 웨이브로 진행
2. 스폰 간격마다 현재 웨이브의 적 스폰 시도
3. 맵 이벤트 트리거 시간 체크
4. 타임 리밋 도달 시 모든 적 제거 후 The Reaper 스폰

**스폰 시도 로직**:
- **최소 수량 미달 시**: 할당량을 채울 때까지 연속 스폰
- **최소 수량 충족 시**: 웨이브의 각 적 타입당 1개씩만 스폰

## 현재 프로젝트 적용 방안

### 1. 단계적 전환
- **Phase 1**: 기존 웨이브 시스템 유지하면서 자동 진행 추가
  - 웨이브를 수동에서 시간 기반 자동 진행으로 변경

- **Phase 2**: 스폰 로직 개선
  - 최소/최대 적 수량 관리 시스템 도입
  - 화면 밖 스폰 및 디스폰 구현

- **Phase 3**: 맵 이벤트 시스템
  - 특정 시간대 특수 스폰 이벤트 추가
  - 엘리트/보스 적 시간 기반 등장

### 2. 난이도 곡선 설계

| 시간대 | 단계 | 특징 |
|--------|------|------|
| 0-5분 | 튜토리얼 | 소수의 약한 적 |
| 5-10분 | 성장 | 적 타입 다양화 |
| 10-15분 | 도전 | 밀도 증가 |
| 15-20분 | 극한 | 특수 이벤트 빈번 |
| 20분+ | 서바이벌 | 압도적 물량 |

### 3. 기술적 구현 포인트

1. **타이머 시스템**: Time.deltaTime 누적으로 경과 시간 추적
2. **오브젝트 풀링**: 적 생성/제거 최적화
3. **데이터 기반 설정**: ScriptableObject로 웨이브/이벤트 데이터 관리
4. **화면 밖 스폰**: 적 생성 위치 및 디스폰 로직

## 핵심 인사이트

Vampire Survivors의 스폰 시스템이 효과적인 이유:
1. **시간 기반 자동 진행** → 플레이어가 게임 플레이에 집중
2. **최소 수량 유지** → 일정한 압박감 제공
3. **맵 이벤트** → 예측 가능성과 긴장감의 균형
4. **타임 리밋** → 명확한 게임 종료 지점

현재 프로젝트에 적용 시, 기존 웨이브 시스템을 제거하는 것이 아니라 **시간에 따라 자동으로 진행되는 웨이브**로 전환하는 것이 핵심입니다.

## 관련 구현 파일

향후 구현 시 참고할 파일:
- `EnemySpawnManager.cs` - 스폰 매니저
- `WaveData.cs` - 웨이브 데이터 ScriptableObject
- `MapEventData.cs` - 맵 이벤트 데이터
- `GameTimer.cs` - 게임 경과 시간 관리

## 참고 자료

- [Vampire Survivors Wiki - Timed Enemy Spawn](https://vampire-survivors.fandom.com/wiki/Timed_Enemy_Spawn)
- [Vampire Survivors Wiki - Stages](https://vampire-survivors.fandom.com/wiki/Stages)
- [Vampire Survivors Wiki - Enemies](https://vampire-survivors.fandom.com/wiki/Enemies)
