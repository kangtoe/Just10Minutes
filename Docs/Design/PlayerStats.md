# 플레이어 스탯 시스템

> 플레이어 기체의 능력치 정의 및 생존 메커니즘

## 생존 시스템: 실드/내구도 분리

### 실드 (Shield)
- **우선 피해 흡수**: 모든 피해를 실드가 먼저 받음
- **자동 재생**: 피해를 받지 않으면 자동 회복
  - 재생 지연: 마지막 피해 후 2초 대기
  - 재생 속도: 초당 20 (업그레이드 가능)
- **소진 가능**: 실드가 0이 되어도 게임은 계속됨

### 내구도 (Durability)
- **최후의 방어선**: 실드 소진 후 피해 받음
- **회복 제한**: 레벨업 시 일부 회복만 가능 (자동 재생 없음)
- **0 = 게임 오버**: 내구도가 0이 되면 즉시 사망

### UI 표시
```
[=====실드=====] 100/100 (파란색/청록색)
[====내구도====]  80/100 (빨간색)
```

---

## 스탯 목록

### 생존 (Survival)
| 스탯 | 기본값 | 설명 | 업그레이드 |
|-----|--------|------|-----------|
| 최대 내구도 | 100 | HP 최대치 | ✅ +50 (최대 10회) |
| 최대 실드 | 100 | 실드 최대치 | ✅ +50 (최대 10회) |
| 실드 재생 속도 | 20/초 | 실드 자동 회복 속도 | ✅ +5/초 (최대 8회) |
| 실드 재생 지연 | 2초 | 피해 후 재생 시작까지 대기 시간 | ✅ -0.2초 (최대 5회) |
| 내구도 재생 속도 | 0/초 | HP 자동 회복 속도 | ✅ +2/초 (최대 8회) |
| 내구도 재생 지연 | 5초 | 피해 후 재생 시작까지 대기 시간 | ✅ -0.2초 (최대 5회) |

### 사격 (Shooting)
| 스탯 | 기본값 | 설명 | 업그레이드 |
|-----|--------|------|-----------|
| 멀티샷 | 1 | 한 번에 발사하는 탄환 수 | ✅ +1 (최대 4회) |
| 연사 속도 | 1.0 | 발사 간격 배율 (높을수록 빠름) | ✅ +0.2 (최대 5회) |
| 발사체 피해 | 10 | 탄환 1발당 피해량 | ✅ +5 (최대 10회) |
| 발사체 속도 | 10 | 탄환 이동 속도 | ✅ +2 (최대 5회) |

### 충돌 (Impact)
| 스탯 | 기본값 | 설명 | 업그레이드 |
|-----|--------|------|-----------|
| 충돌 피해 | 10 | 적과 부딪힐 때 주는 피해 | ✅ +5 (최대 10회) |
| 충돌 저항 | 0 | 충돌 시 받는 피해 감소 | ✅ +5 (최대 10회) |

### 이동 (Mobility)
| 스탯 | 기본값 | 설명 | 업그레이드 |
|-----|--------|------|-----------|
| 이동 속도 | 5 | 자동 전진 속도 | ✅ +1 (최대 5회) |
| 회전 속도 | 180°/s | 방향 전환 속도 | ✅ +30°/s (최대 5회) |
| 질량 | 1 | 넉백 저항 및 충돌 피해 계산 | ❌ (미구현) |

---

## 빌드 스타일

상세한 빌드 조합은 [BuildCombinations.md](../Design/UpgradeSystem/BuildCombinations.md) 참고

**탱커**: 최대 내구도/실드 + 실드 재생 + 충돌 피해
**사격**: 멀티샷 + 연사 속도 + 발사체 피해
**충돌**: 충돌 피해 + 이동 속도 + 실드
**기동**: 이동/회전 속도 + 실드 재생

---

## 추가 구현 후보

### 우선순위 1: 기존 메커니즘 확장
| 스탯 | 효과 | 예상 증분 | 필요 작업 |
|-----|------|---------|----------|
| 질량 | 넉백 저항 증가, 충돌 피해 증가 | +0.5 | ✅ CSV 추가됨 (충돌 계산식은 미구현) |

### 우선순위 2: 발사체 강화
| 스탯 | 효과 | 예상 증분 | 필요 작업 |
|-----|------|---------|----------|
| 관통 | 탄환이 여러 적을 관통 | +1 | BulletBase에 관통 카운터 추가 |
| 발사체 크기 | 탄환 크기 증가 (명중률 향상) | +0.2x | Transform.localScale 조정 |
| 넉백 파워 | 탄환 명중 시 적을 밀어냄 | +5 | BulletBase에 넉백 힘 추가 |
| 발사체 수명 | 탄환 존재 시간 증가 | +0.5초 | BulletBase.lifeTime 수정 |

### 우선순위 3: 특수 메커니즘
| 스탯 | 효과 | 예상 증분 | 필요 작업 |
|-----|------|---------|----------|
| 치명타 확률 | 일정 확률로 피해 2배 | +10% | 피해 계산에 랜덤 체크 추가 |
| 치명타 피해 | 치명타 발생 시 피해 배율 | +0.5x | 치명타 피해 계산식 수정 |
| 생명력 흡수 | 준 피해의 일부를 HP로 회복 | +5% | 피해 이벤트에서 회복 처리 |
| 경험치 보너스 | 획득 경험치 증가 | +20% | LevelManager.GetExp() 수정 |

### 우선순위 4: 새로운 시스템
| 스탯 | 효과 | 필요 작업 |
|-----|------|----------|
| 드론 | 플레이어를 따라다니며 공격하는 드론 추가 | DroneMaster 시스템 활성화 |
| 실드 과충전 | 최대 실드를 초과하여 충전 가능 (150%까지) | Damageable 로직 수정 |
| 애프터버너 | 일시적 속도 증가 + 잔상 효과 | AfterImageMaker 시스템 활성화 |
| 폭발 탄환 | 명중 시 범위 피해 | 새 발사체 타입 추가 |
| 유도 탄환 | 적을 추적하는 미사일 | BulletChase 활성화 |

---

## 구현 상태

- ✅ **구현됨**: CSV에 정의되고 게임에서 선택 가능 (15개)
- 📋 **계획 중**: 추가 구현 후보 (15개)

**현재 총 15개 업그레이드 구현** (생존 6개, 사격 4개, 충돌 2개, 이동 3개)

---

## 시스템 리팩토링 (2026-01-27)

PlayerStatsManager가 Dictionary 기반 구조로 리팩토링되었습니다:

### 주요 변경 사항
- **메타데이터 중앙 관리**: `StatMetadata.cs` 및 `StatMetadataRegistry` 추가
- **Switch 문 제거**: `PlayerStatsManager.ApplyUpgrade()`, `UpgradeData` 메서드들에서 switch 문 제거
- **CSV 확장**: `DefaultValue`, `Unit`, `IsInteger` 컬럼 추가하여 모든 밸런싱 데이터 통합
- **새 스탯 추가 간소화**: CSV 1줄 + Enum 1줄만 수정하면 됨

### 추가된 스탯
- 내구도 재생 속도 (DurabilityRegenRate): 기본값 0, +2/초 증분
- 내구도 재생 지연 (DurabilityRegenDelay): 기본값 5초, -0.2초 증분
- 질량 (Mass): 기본값 1, +0.5 증분 (CSV 추가, 게임플레이 미구현)
